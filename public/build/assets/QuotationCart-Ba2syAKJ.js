import{r as l,q as _,j as e,B as T,y as D}from"./app-C9pLc5ld.js";import{S as w,D as E,A as B,s as A}from"./Css-txpIKB5n.js";const I=l.createContext(null),y=()=>l.useContext(I),Y=({children:c})=>{const{isEditPage:r,quotation:a,taxRates:d}=_().props,[m,i]=l.useState([{product_id:"",quantity:1,unit_price:0}]),[x,h]=l.useState([]),[p,t]=l.useState(0),[s,N]=l.useState(0),[F,Q]=l.useState(0),[C,S]=l.useState(0),[v,n]=l.useState(0),[b,q]=l.useState(0),P=()=>{i([...m,{product_id:"",quantity:1,unit_price:0}])},k=(f,u)=>{i(j=>j.map((o,g)=>g===f?{...o,...u}:o))},U=f=>{let u=m.filter((j,o)=>f!==o);i(u)},M=()=>{h([...x,{tax_rate_id:"",percent:0,amount:0}])},R=(f,u)=>{h(j=>j.map((o,g)=>g===f?{...o,...u}:o)),q(j=>j+1)},V=f=>{let u=x.filter((j,o)=>f!==o);h(u)};return l.useEffect(()=>{let f=0,u=0;m.forEach(j=>{f+=j.quantity,u+=parseFloat(j.unit_price)*j.quantity}),Q(f),S(u),h(j=>j.map(o=>({...o,amount:(o.percent/100*u).toFixed(2)})))},[m,b]),l.useEffect(()=>{const f=x.reduce((j,o)=>j+parseFloat(o.amount),0),u=C+parseFloat(s.toString())+f-parseFloat(p.toString());n(u)},[x,C,s,p]),l.useEffect(()=>{if(r){const{products:f,taxes:u}=a||{};(f==null?void 0:f.length)>0&&i(j=>f.map(o=>({product_id:o.product_id,quantity:o.quantity,unit_price:o.unit_price}))),(u==null?void 0:u.length)>0&&h(j=>u.map(o=>{const g=d.find(L=>L.id===o.tax_rate_id);return{tax_rate_id:o.tax_rate_id,percent:(g==null?void 0:g.percent)||0,amount:o.amount}})),t((a==null?void 0:a.discount_amount)||0),N((a==null?void 0:a.delivery_charge)||0)}},[]),e.jsx(I.Provider,{value:{items:m,setItems:i,taxes:x,setTaxes:h,discountAmount:p,setDiscountAmount:t,deliveryCharge:s,setDeliveryCharge:N,quotationQuantity:F,setQuotationQuantity:Q,quotationSubtotal:C,setQuotationSubtotal:S,quotationTotalAmount:v,setQuotationTotalAmount:n,forceCalculate:b,setForceCalculate:q,addQuotationItem:P,updateQuotationItem:k,removeQuotationItem:U,addQuotationTax:M,updateQuotationTax:R,removeQuotationTax:V},children:c})};function Z(){const{users:c,isEditPage:r,quotation:a}=_().props,{items:d,taxes:m,discountAmount:i,deliveryCharge:x}=y(),[h,p]=l.useState({user_id:null,date:new Date,due_date:new Date,reference_no:"",file:"",note:"",items:d,taxes:m,discount_amount:i,delivery_charge:x}),{errors:t}=_().props,[s,N]=l.useState({label:"Please select",value:""}),[F,Q]=l.useState("Choose file"),C=n=>{n.preventDefault(),D.post("/quotation",h,{onSuccess:()=>{T.success("The quotation added successfully")}})},S=n=>{n.preventDefault(),D.put("/quotation/"+a.id,h,{onSuccess:()=>{T.success("The quotation update successfully")}})},v=(n,b)=>{p(q=>({...q,[n]:b}))};return l.useEffect(()=>{if(a){p(b=>({...b,user_id:a.user_id,date:a.date,due_date:a.due_date,reference_no:a.reference_no||"",note:a.note||""}));const n=c.find(b=>b.value===a.user_id);N(b=>({...b,...n}))}},[]),l.useEffect(()=>{Object.keys(t).length>0&&T.error(Object.values(t)[0])},[t]),l.useEffect(()=>{p(n=>({...n,items:d,taxes:m,discount_amount:i,delivery_charge:x}))},[d,m,i,x]),e.jsx("div",{className:"col-xl-3 col-md-3",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-sm-12",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2 align-content-center",children:[e.jsxs("label",{children:["User ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("button",{"data-toggle":"modal","data-target":"#addQuickUser",type:"button",className:"btn btn-primary btn-sm",children:[e.jsx("i",{className:"fas fa-plus"})," Quick Customer"]})]}),e.jsx(w,{className:t!=null&&t.user_id?"border border-danger rounded":"",name:"user_id",defaultValue:s,options:c,onChange:n=>{v("user_id",n==null?void 0:n.value)}},s==null?void 0:s.value),(t==null?void 0:t.user_id)&&e.jsx("p",{className:"text-danger",children:t.user_id})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date"})," ",e.jsx("span",{className:"text-danger",children:"*"})," ",e.jsx("br",{}),e.jsx(E,{className:t!=null&&t.date?"form-control border border-danger rounded":"form-control",selected:h.date,dateFormat:"dd-MM-yyyy",onChange:n=>{v("date",n)}}),(t==null?void 0:t.date)&&e.jsx("p",{className:"text-danger",children:t.date})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Due Date"})," ",e.jsx("span",{className:"text-danger",children:"*"})," ",e.jsx("br",{}),e.jsx(E,{className:t!=null&&t.due_date?"form-control border border-danger rounded":"form-control",selected:h.due_date,dateFormat:"dd-MM-yyyy",onChange:n=>{v("due_date",n)}}),(t==null?void 0:t.due_date)&&e.jsx("p",{className:"text-danger",children:t.due_date})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference no"}),e.jsx("input",{type:"text",name:"reference_no",className:"form-control",value:h.reference_no,onChange:n=>{v("reference_no",n.target.value)}}),(t==null?void 0:t.reference_no)&&e.jsx("p",{className:"text-danger",children:t.reference_no})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"File"}),e.jsxs("div",{className:"custom-file",children:[e.jsx("input",{id:"file",name:"file",type:"file",className:"custom-file-input",onChange:n=>{n.target.files[0]&&(v("file",n.target.files[0]),Q(n.target.files[0].name))}}),e.jsx("label",{className:"custom-file-label",htmlFor:"file",children:F})]}),(t==null?void 0:t.file)&&e.jsx("p",{className:"text-danger",children:t.file})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Note"}),e.jsx("textarea",{name:"note",cols:"30",rows:"3",value:h.note,className:"form-control",onChange:n=>{v("note",n.target.value)}}),(t==null?void 0:t.note)&&e.jsx("p",{className:"text-danger",children:t.note})]})]})})}),e.jsx("div",{className:"card-footer",children:e.jsxs("button",{type:"submit",className:"btn btn-primary btn-block",onClick:r?S:C,children:[r?"Update":"Create"," Quotation"]})}),e.jsx(B,{setSelectedUserOption:N,handleFormDataUpdate:v})]})})}function H({index:c,tax:r}){const{taxRates:a,quotation:d,isEditPage:m}=_().props,{updateQuotationTax:i,removeQuotationTax:x}=y(),[h,p]=l.useState({label:"Please select",value:""});return l.useEffect(()=>{if(d&&m){const t=a.find(s=>s.id===r.tax_rate_id);t&&p(s=>({...s,value:t.id,label:t.name}))}},[d,a,r]),e.jsxs("div",{className:"form-group row",children:[e.jsx("div",{className:"col-sm-6",children:e.jsx(w,{name:"product_id",styles:A,defaultValue:h,options:a.map(t=>({label:t==null?void 0:t.name_with_percent,value:t.id})),onChange:t=>{const s=a.find(N=>N.id===(t==null?void 0:t.value));s&&(p(N=>({...N,value:s.id,label:s.name})),i(c,{tax_rate_id:s.id,percent:s.percent}))}},Math.random())}),e.jsx("div",{className:"col-sm-6",children:e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",value:r.amount,className:"form-control form-control-sm",readOnly:!0}),e.jsx("div",{className:"input-group-append",children:e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>x(c),children:e.jsx("i",{className:"fa fa-trash"})})})]})})]})}function $(){const{taxes:c,addQuotationTax:r}=y();return e.jsxs(e.Fragment,{children:[c.length>0&&e.jsx("div",{children:c.map((a,d)=>e.jsx(H,{index:d,tax:a},d))}),e.jsx("hr",{}),e.jsx("div",{className:"form-group row",children:e.jsx("div",{className:"col-sm-12",children:e.jsxs("button",{className:"btn btn-primary btn-sm btn-block",onClick:r,children:[e.jsx("i",{className:"fa fa-plus"})," Add Tax"]})})})]})}function z(){const{quotationSubtotal:c,discountAmount:r,setDiscountAmount:a,deliveryCharge:d,setDeliveryCharge:m,quotationTotalAmount:i}=y();return e.jsx("div",{className:"col-md-6 offset-md-6",children:e.jsxs("div",{className:"invoice-summary",children:[e.jsxs("div",{className:"form-group row",children:[e.jsx("label",{htmlFor:"staticEmail",className:"col-sm-6 col-form-label",children:"Subtotal"}),e.jsx("div",{className:"col-sm-6",children:e.jsx("span",{className:"form-control-plaintext totalSubtotal font-weight-bold",children:c.toFixed(2)})})]}),e.jsxs("div",{className:"form-group row",children:[e.jsx("label",{htmlFor:"inputPassword",className:"col-sm-6 col-form-label",children:"Discount"}),e.jsx("div",{className:"col-sm-6",children:e.jsx("input",{type:"number",min:"0",value:r,onChange:x=>{a(x.target.value)},className:"form-control form-control-sm"})})]}),e.jsxs("div",{className:"form-group row",children:[e.jsx("label",{htmlFor:"inputPassword",className:"col-sm-6 col-form-label",children:"Delivery Charge"}),e.jsx("div",{className:"col-sm-6",children:e.jsx("input",{type:"number",min:"0",value:d,onChange:x=>{m(x.target.value)},className:"form-control form-control-sm"})})]}),e.jsx($,{}),e.jsx("hr",{}),e.jsxs("div",{className:"form-group row",children:[e.jsx("label",{htmlFor:"staticEmail",className:"col-sm-6 col-form-label",children:"Total Amount"}),e.jsx("div",{className:"col-sm-6",children:e.jsx("span",{className:"form-control-plaintext",children:i.toFixed(2)})})]})]})})}function G(){return e.jsxs("tr",{className:"d-flex",children:[e.jsx("th",{className:"col-5",children:"Product"}),e.jsx("th",{className:"col-2",children:"Qty"}),e.jsx("th",{className:"col-2",children:"Unit Price"}),e.jsx("th",{className:"col-2",children:"Subtotal"}),e.jsx("th",{className:"col-1",children:"Action"})]})}function J({index:c,item:r}){const{products:a,quotation:d,isEditPage:m}=_().props,{updateQuotationItem:i,removeQuotationItem:x}=y(),[h,p]=l.useState({label:"Please select",value:""});return l.useEffect(()=>{if(d&&m){const t=a.find(s=>s.id===r.product_id);t&&p(s=>({...s,value:t.id,label:t.name}))}},[d,a,r]),e.jsxs("tr",{className:"d-flex",children:[e.jsx("td",{className:"col-5",children:e.jsx(w,{styles:A,defaultValue:h,options:a.map(t=>({label:t.name,value:t.id})),onChange:t=>{const s=a.find(N=>N.id===(t==null?void 0:t.value));s&&(p(N=>({...N,value:s.id,label:s.name})),i(c,{product_id:s.id,unit_price:s.price}))}},Math.random())}),e.jsx("td",{className:"col-2",children:e.jsx("input",{type:"number",min:"1",value:r.quantity,onChange:t=>{i(c,{quantity:parseInt(t.target.value||1)})},className:"form-control form-control-sm"})}),e.jsx("td",{className:"col-2",children:r.unit_price.toFixed(2)}),e.jsx("td",{className:"col-2",children:(r.quantity*r.unit_price).toFixed(2)}),e.jsx("td",{className:"col-1",children:e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>x(c),children:e.jsx("i",{className:"fa fa-trash"})})})]})}function K(){const{items:c,addQuotationItem:r,quotationQuantity:a,quotationSubtotal:d}=y();return e.jsxs("div",{className:"col-sm-12",children:[e.jsxs("table",{className:"table table-sm table-bordered",width:"100%",cellSpacing:"0",children:[e.jsx("thead",{children:e.jsx(G,{})}),e.jsx("tbody",{className:"small-select2",children:c.length>0&&c.map((m,i)=>e.jsx(J,{index:i,item:m},i))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"d-flex",children:[e.jsx("th",{className:"col-5"}),e.jsx("th",{className:"col-2",children:a}),e.jsx("th",{className:"col-2"}),e.jsx("th",{className:"col-2",children:d.toFixed(2)}),e.jsx("th",{className:"col-1"})]})})]}),e.jsxs("button",{className:"btn btn-sm btn-primary btn-block",onClick:r,children:[e.jsx("i",{className:"fas fa-shopping-basket"})," Add an Item"]}),e.jsx("hr",{})]})}function O(){const{isEditPage:c}=_().props;return e.jsx("div",{className:"col-xl-9 col-md-9",children:e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{children:[c?"Update":"Create"," Quotation"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx(K,{}),e.jsx(z,{})]})})]})})}export{Y as Q,Z as a,O as b};
