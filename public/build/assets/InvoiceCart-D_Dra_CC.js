import{r as l,q as _,j as e,B as w,y as E}from"./app-C9pLc5ld.js";import{S as D,D as A,A as B,s as P}from"./Css-txpIKB5n.js";const k=l.createContext(null),y=()=>l.useContext(k),Y=({children:r})=>{const{isEditPage:o,invoice:t,taxRates:d}=_().props,[u,i]=l.useState([{product_id:"",quantity:1,unit_price:0}]),[m,x]=l.useState([]),[p,s]=l.useState(0),[a,v]=l.useState(0),[T,C]=l.useState(0),[I,S]=l.useState(0),[b,n]=l.useState(0),[N,F]=l.useState(0),q=()=>{i([...u,{product_id:"",quantity:1,unit_price:0}])},U=(j,f)=>{i(h=>h.map((c,g)=>g===j?{...c,...f}:c))},Q=j=>{let f=u.filter((h,c)=>j!==c);i(f)},M=()=>{x([...m,{tax_rate_id:"",percent:0,amount:0}])},R=(j,f)=>{x(h=>h.map((c,g)=>g===j?{...c,...f}:c)),F(h=>h+1)},V=j=>{let f=m.filter((h,c)=>j!==c);x(f)};return l.useEffect(()=>{let j=0,f=0;u.forEach(h=>{j+=h.quantity,f+=parseFloat(h.unit_price)*h.quantity}),C(j),S(f),x(h=>h.map(c=>({...c,amount:(c.percent/100*f).toFixed(2)})))},[u,N]),l.useEffect(()=>{const j=m.reduce((h,c)=>h+parseFloat(c.amount),0),f=I+parseFloat(a.toString())+j-parseFloat(p.toString());n(f)},[m,I,a,p]),l.useEffect(()=>{if(o){const{products:j,taxes:f}=t||{};j.length>0&&i(h=>j.map(c=>({product_id:c.product_id,quantity:c.quantity,unit_price:c.unit_price}))),f.length>0&&x(h=>f.map(c=>{const g=d.find(L=>L.id===c.tax_rate_id);return{tax_rate_id:c.tax_rate_id,percent:(g==null?void 0:g.percent)||0,amount:c.amount}})),s((t==null?void 0:t.discount_amount)||0),v((t==null?void 0:t.delivery_charge)||0)}},[]),e.jsx(k.Provider,{value:{items:u,setItems:i,taxes:m,setTaxes:x,discountAmount:p,setDiscountAmount:s,deliveryCharge:a,setDeliveryCharge:v,invoiceQuantity:T,setInvoiceQuantity:C,invoiceSubtotal:I,setInvoiceSubtotal:S,invoiceTotalAmount:b,setInvoiceTotalAmount:n,forceCalculate:N,setForceCalculate:F,addInvoiceItem:q,updateInvoiceItem:U,removeInvoiceItem:Q,addInvoiceTax:M,updateInvoiceTax:R,removeInvoiceTax:V},children:r})};function Z(){const{users:r,isEditPage:o,invoice:t}=_().props,{items:d,taxes:u,discountAmount:i,deliveryCharge:m}=y(),[x,p]=l.useState({user_id:null,date:new Date,due_date:new Date,reference_no:"",file:"",note:"",items:d,taxes:u,discount_amount:i,delivery_charge:m}),{errors:s}=_().props,[a,v]=l.useState({label:"Please select",value:""}),[T,C]=l.useState("Choose file"),I=n=>{n.preventDefault(),E.post("/invoice",x,{onSuccess:()=>{w.success("The invoice added successfully")}})},S=n=>{n.preventDefault(),E.put("/invoice/"+t.id,x,{onSuccess:()=>{w.success("The invoice update successfully")}})},b=(n,N)=>{p(F=>({...F,[n]:N}))};return l.useEffect(()=>{if(t){p(N=>({...N,user_id:t.user_id,date:t.date,due_date:t.due_date,reference_no:t.reference_no||"",note:t.note||""}));const n=r.find(N=>N.value===t.user_id);v(N=>({...N,...n}))}},[]),l.useEffect(()=>{Object.keys(s).length>0&&w.error(Object.values(s)[0])},[s]),l.useEffect(()=>{p(n=>({...n,items:d,taxes:u,discount_amount:i,delivery_charge:m}))},[d,u,i,m]),e.jsx("div",{className:"col-xl-3 col-md-3",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-sm-12",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2 align-content-center",children:[e.jsxs("label",{children:["User ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("button",{"data-toggle":"modal","data-target":"#addQuickUser",type:"button",className:"btn btn-primary btn-sm",children:[e.jsx("i",{className:"fas fa-plus"})," Quick Customer"]})]}),e.jsx(D,{className:s!=null&&s.user_id?"border border-danger rounded":"",name:"user_id",defaultValue:a,options:r,onChange:n=>{b("user_id",n==null?void 0:n.value)}},a==null?void 0:a.value),(s==null?void 0:s.user_id)&&e.jsx("p",{className:"text-danger",children:s.user_id})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date"})," ",e.jsx("span",{className:"text-danger",children:"*"})," ",e.jsx("br",{}),e.jsx(A,{className:s!=null&&s.date?"form-control border border-danger rounded":"form-control",selected:x.date,dateFormat:"dd-MM-yyyy",onChange:n=>{b("date",n)}}),(s==null?void 0:s.date)&&e.jsx("p",{className:"text-danger",children:s.date})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Due Date"})," ",e.jsx("span",{className:"text-danger",children:"*"})," ",e.jsx("br",{}),e.jsx(A,{className:s!=null&&s.due_date?"form-control border border-danger rounded":"form-control",selected:x.due_date,dateFormat:"dd-MM-yyyy",onChange:n=>{b("due_date",n)}}),(s==null?void 0:s.due_date)&&e.jsx("p",{className:"text-danger",children:s.due_date})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference no"}),e.jsx("input",{type:"text",name:"reference_no",className:"form-control",value:x.reference_no,onChange:n=>{b("reference_no",n.target.value)}}),(s==null?void 0:s.reference_no)&&e.jsx("p",{className:"text-danger",children:s.reference_no})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"File"}),e.jsxs("div",{className:"custom-file",children:[e.jsx("input",{id:"file",name:"file",type:"file",className:"custom-file-input",onChange:n=>{n.target.files[0]&&(b("file",n.target.files[0]),C(n.target.files[0].name))}}),e.jsx("label",{className:"custom-file-label",htmlFor:"file",children:T})]}),(s==null?void 0:s.file)&&e.jsx("p",{className:"text-danger",children:s.file})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Note"}),e.jsx("textarea",{name:"note",cols:"30",rows:"3",value:x.note,className:"form-control",onChange:n=>{b("note",n.target.value)}}),(s==null?void 0:s.note)&&e.jsx("p",{className:"text-danger",children:s.note})]})]})})}),e.jsx("div",{className:"card-footer",children:e.jsxs("button",{type:"submit",className:"btn btn-primary btn-block",onClick:o?S:I,children:[o?"Update":"Create"," Invoice"]})}),e.jsx(B,{setSelectedUserOption:v,handleFormDataUpdate:b})]})})}function H({index:r,tax:o}){const{taxRates:t,invoice:d,isEditPage:u}=_().props,{updateInvoiceTax:i,removeInvoiceTax:m}=y(),[x,p]=l.useState({label:"Please select",value:""});return l.useEffect(()=>{if(d&&u){const s=t.find(a=>a.id===o.tax_rate_id);s&&p(a=>({...a,value:s.id,label:s.name}))}},[d,t,o]),e.jsxs("div",{className:"form-group row",children:[e.jsx("div",{className:"col-sm-6",children:e.jsx(D,{name:"product_id",styles:P,defaultValue:x,options:t.map(s=>({label:s==null?void 0:s.name_with_percent,value:s.id})),onChange:s=>{const a=t.find(v=>v.id===(s==null?void 0:s.value));a&&(p(v=>({...v,value:a.id,label:a.name})),i(r,{tax_rate_id:a.id,percent:a.percent}))}},Math.random())}),e.jsx("div",{className:"col-sm-6",children:e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",value:o.amount,className:"form-control form-control-sm",readOnly:!0}),e.jsx("div",{className:"input-group-append",children:e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>m(r),children:e.jsx("i",{className:"fa fa-trash"})})})]})})]})}function $(){const{taxes:r,addInvoiceTax:o}=y();return e.jsxs(e.Fragment,{children:[r.length>0&&e.jsx("div",{children:r.map((t,d)=>e.jsx(H,{index:d,tax:t},d))}),e.jsx("hr",{}),e.jsx("div",{className:"form-group row",children:e.jsx("div",{className:"col-sm-12",children:e.jsxs("button",{className:"btn btn-primary btn-sm btn-block",onClick:o,children:[e.jsx("i",{className:"fa fa-plus"})," Add Tax"]})})})]})}function z(){const{invoiceSubtotal:r,discountAmount:o,setDiscountAmount:t,deliveryCharge:d,setDeliveryCharge:u,invoiceTotalAmount:i}=y();return e.jsx("div",{className:"col-md-6 offset-md-6",children:e.jsxs("div",{className:"invoice-summary",children:[e.jsxs("div",{className:"form-group row",children:[e.jsx("label",{htmlFor:"staticEmail",className:"col-sm-6 col-form-label",children:"Subtotal"}),e.jsx("div",{className:"col-sm-6",children:e.jsx("span",{className:"form-control-plaintext totalSubtotal font-weight-bold",children:r.toFixed(2)})})]}),e.jsxs("div",{className:"form-group row",children:[e.jsx("label",{htmlFor:"inputPassword",className:"col-sm-6 col-form-label",children:"Discount"}),e.jsx("div",{className:"col-sm-6",children:e.jsx("input",{type:"number",min:"0",value:o,onChange:m=>{t(m.target.value)},className:"form-control form-control-sm"})})]}),e.jsxs("div",{className:"form-group row",children:[e.jsx("label",{htmlFor:"inputPassword",className:"col-sm-6 col-form-label",children:"Delivery Charge"}),e.jsx("div",{className:"col-sm-6",children:e.jsx("input",{type:"number",min:"0",value:d,onChange:m=>{u(m.target.value)},className:"form-control form-control-sm"})})]}),e.jsx($,{}),e.jsx("hr",{}),e.jsxs("div",{className:"form-group row",children:[e.jsx("label",{htmlFor:"staticEmail",className:"col-sm-6 col-form-label",children:"Total Amount"}),e.jsx("div",{className:"col-sm-6",children:e.jsx("span",{className:"form-control-plaintext",children:i.toFixed(2)})})]})]})})}function G(){return e.jsxs("tr",{className:"d-flex",children:[e.jsx("th",{className:"col-5",children:"Product"}),e.jsx("th",{className:"col-2",children:"Qty"}),e.jsx("th",{className:"col-2",children:"Unit Price"}),e.jsx("th",{className:"col-2",children:"Subtotal"}),e.jsx("th",{className:"col-1",children:"Action"})]})}function J({index:r,item:o}){const{products:t,invoice:d,isEditPage:u}=_().props,{updateInvoiceItem:i,removeInvoiceItem:m}=y(),[x,p]=l.useState({label:"Please select",value:""});return l.useEffect(()=>{if(d&&u){const s=t.find(a=>a.id===o.product_id);s&&p(a=>({...a,value:s.id,label:s.name}))}},[d,t,o]),e.jsxs("tr",{className:"d-flex",children:[e.jsx("td",{className:"col-5",children:e.jsx(D,{styles:P,defaultValue:x,options:t.map(s=>({label:s.name,value:s.id})),onChange:s=>{const a=t.find(v=>v.id===(s==null?void 0:s.value));a&&(p(v=>({...v,value:a.id,label:a.name})),i(r,{product_id:a.id,unit_price:a.price}))}},Math.random())}),e.jsx("td",{className:"col-2",children:e.jsx("input",{type:"number",min:"1",value:o.quantity,onChange:s=>{i(r,{quantity:parseInt(s.target.value||1)})},className:"form-control form-control-sm"})}),e.jsx("td",{className:"col-2",children:o.unit_price.toFixed(2)}),e.jsx("td",{className:"col-2",children:(o.quantity*o.unit_price).toFixed(2)}),e.jsx("td",{className:"col-1",children:e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>m(r),children:e.jsx("i",{className:"fa fa-trash"})})})]})}function K(){const{items:r,addInvoiceItem:o,invoiceQuantity:t,invoiceSubtotal:d}=y();return e.jsxs("div",{className:"col-sm-12",children:[e.jsxs("table",{className:"table table-sm table-bordered",width:"100%",cellSpacing:"0",children:[e.jsx("thead",{children:e.jsx(G,{})}),e.jsx("tbody",{className:"small-select2",children:r.length>0&&r.map((u,i)=>e.jsx(J,{index:i,item:u},i))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"d-flex",children:[e.jsx("th",{className:"col-5"}),e.jsx("th",{className:"col-2",children:t}),e.jsx("th",{className:"col-2"}),e.jsx("th",{className:"col-2",children:d.toFixed(2)}),e.jsx("th",{className:"col-1"})]})})]}),e.jsxs("button",{className:"btn btn-sm btn-primary btn-block",onClick:o,children:[e.jsx("i",{className:"fas fa-shopping-basket"})," Add an Item"]}),e.jsx("hr",{})]})}function O(){const{isEditPage:r}=_().props;return e.jsx("div",{className:"col-xl-9 col-md-9",children:e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{children:[r?"Update":"Create"," Invoice"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx(K,{}),e.jsx(z,{})]})})]})})}export{Y as I,Z as a,O as b};
